apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: minio
  namespace: minio-distributed
spec:
  serviceName: minio-headless
  replicas: 4
  selector:
    matchLabels:
      app: minio
  template:
    metadata:
      labels:
        app: minio
    spec:
      containers:
        - name: minio
          image: minio/minio:RELEASE.2024-01-18T22-51-28Z # Pin version for stability
          args:
            - server
            # This expansion syntax {0...3} tells MinIO to look for minio-0, minio-1, etc.
            - http://minio-{0...3}.minio-headless.minio-distributed.svc.cluster.local/data
            - --console-address
            - :9001
          env:
            - name: MINIO_ROOT_USER
              value: "admin"
            - name: MINIO_ROOT_PASSWORD
              value: "MinioStrongPassword123!"
          ports:
            - containerPort: 9000
            - containerPort: 9001
          volumeMounts:
            - name: data
              mountPath: /data
  # Automatically creates a 1GB volume for EACH pod (4GB total)
  volumeClaimTemplates:
    - metadata:
        name: data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 1Gi
